/* backbone-lifeguard - v0.1.0 - 2012-06-27 */
(function(a){function m(a){var c=this;return b.isNull(a)||b["is"+c.type](a)}function n(a){var c=this;return b.isNull(a)||a instanceof c.type}function o(a){var b=a,c=this;return a instanceof c.type||(b=new c.type(a)),b}var b=a._||require("underscore"),c=a.Backbone||require("backbone"),d=c.Model,e=d.extend,f=d.prototype,g=f.set,h=f._validate,i=f.isValid,j=f.toJSON,k=c.Collection,l=Object.prototype.toString,p={string:{type:"String",_typeCheck:m},number:{type:"Number",_typeCheck:m},array:{type:"Array",_typeCheck:m},object:{type:"Object",_typeCheck:m},"boolean":{type:"Boolean",_typeCheck:m},regexp:{type:"RegExp",transform:function(a){var c=a;return b.isString(a)&&(c=new RegExp(a)),c},_typeCheck:m},date:{type:"Date",transform:function(a){var c=a;return b.isString(a)&&(c=new Date(a),isNaN(c.valueOf())&&(c=void 0)),c},_typeCheck:m},integer:{type:"Number"},_class:{transform:o,_typeCheck:n},_model:{transform:o,_typeCheck:n},_collection:{transform:o,_typeCheck:n}},q=["_class","_model","_collection"],r={_validate:function(a,c){var d=this,e=d.fields,f=[],g;return b.each(a,function(c,d){var h=e[d],i=c;if(h){b.isFunction(h.transform)&&(i=h.transform(i));if(b.isFunction(h.validate)){g=h.validate(i);if(g){f.push(g);return}}if(b.isFunction(h._typeCheck)){g=!h._typeCheck(i);if(g){f.push('Error: Failed type check for attribute "'+d+'".');return}}a[d]=i}else f.push('Error: Undeclared attribute "'+d+'".')}),b.isEmpty(f)?h.call(d,a,c):(c&&c.error?c.error(d,f,c):d.trigger("error",d,f,c),!1)},toJSON:function(a){var b=this;return j.call(b,a)}};d.extend=function(a,c){var g=!1,h=a&&a.defaults||{},i=a&&a.fields;return i&&b.isObject(i)&&(b.each(i,function(a,c){var e,f;if(!g){if(!b.isObject(a)){console.warn('Backbone-Lifeguard cannot be initialized: "fields" must contain only objects.'),g=!0;return}b.has(a,"value")&&!b.has(h,c)&&(h[c]=a.value);if(b.has(a,"type")){e=a.type;if(b.isString(e)){e=e.toLowerCase();if(b.contains(q,e)){console.warn('Backbone-lifeguard cannot be initialized: reserved type for attribute "'+c+'".'),g=!0;return}}else e=l.call(e).slice(8,-1).toLowerCase();e==="function"&&(a.type.prototype instanceof d?e="_model":a.type.prototype instanceof k?e="_collection":e="_class"),f=p[e];if(f)b.defaults(a,f);else{console.warn('Backbone-lifeguard cannot be initialized: unsupported data type for attribute "'+c+'".'),g=!0;return}}}}),g||(b.each(h,function(a,c){var d=this;if(!b.has(i,c))i[c]={value:a};else if(i[c].value!==a)return d.trigger("error",d,c),null}),a.defaults=h,a.fields=i,b.extend(f,r))),e.call(d,a,c)}})(this);